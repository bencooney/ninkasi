<html>
<head>
	<script type="text/javascript">
		function ledToggle(board, state) {
	    console.log('sending led='+state+' to board ' + board );
	    var mode = 'off';
	    if(state){
	    	mode = 'on'
	    }
	    httpPut('/arduino/'+board+'/led/'+mode, function(){});
		}

		function getBoards(){
			httpGet('/arduino/', function(devicesJson){
				var listHtml = "";
				JSON.parse(devicesJson).devices.forEach( function(obj){
					listHtml += "<div>" +
						"  <h3>Device: "+ obj +"</h3>" +
						"  <p>LED"+
						"    <button onclick=\"ledToggle('"+obj+"',true)\">On</button>" +
						"    <button onclick=\"ledToggle('"+obj+"',false)\">Off</button>" +
						"    <button id='cmdBoard"+obj+"Details' onclick=\"getBoardDetails('"+obj+"')\">\\/</button>" +
						"    <div id='board"+obj+"Details'></div>"
						"  </p>" +
						"</div>";
				});
				document.getElementById('devices').innerHTML = listHtml;
			});
		}

		function getBoardDetails(boardId){
			httpGet('/arduino/'+boardId, function(boardText){
				var boardJson = JSON.parse(boardText);
				detailsHtml = "<list>"+
					" <li><strong>port: </strong>"+boardJson.device.port+"</li>" +
					" <li><strong>repl: </strong>"+boardJson.device.repl+"</li>" +
					" <li><strong>debug: </strong>"+boardJson.device.debug+"</li>" +
					"</list>";
				document.getElementById('board'+boardId+'Details').innerHTML = detailsHtml;
				document.getElementById('cmdBoard'+boardId+'Details').innerHTML = "/\\";
				document.getElementById('cmdBoard'+boardId+'Details').setAttribute('onclick',"hideBoardDetails('"+boardId+"')");
			});
		}

		function hideBoardDetails(boardId){
			document.getElementById('board'+boardId+'Details').innerHTML = "";
			document.getElementById('cmdBoard'+boardId+'Details').innerHTML = "\\/";
		  document.getElementById('cmdBoard'+boardId+'Details').setAttribute('onclick',"getBoardDetails('"+boardId+"')");
		}

		function httpGet(targetUrl, callback) {
	    var xmlHttp = new XMLHttpRequest();
	    xmlHttp.onreadystatechange = function() { 
	      if (xmlHttp.readyState == 4 && xmlHttp.status == 200)
	        callback(xmlHttp.responseText);
	    }
	    xmlHttp.open("GET", targetUrl, true); // true for asynchronous 
	    xmlHttp.send(null);
		}

		function httpPut(targetUrl, callback) {
			var xmlHttp = new XMLHttpRequest();
	    xmlHttp.onreadystatechange = function() { 
	      if (xmlHttp.readyState == 4 && xmlHttp.status == 200)
	        callback(xmlHttp.responseText);
	    }
	    xmlHttp.open("PUT", targetUrl, true); // true for asynchronous 
	    xmlHttp.send(null);
		}
	</script>
</head>
<body onload="getBoards()">
	<h1>ninkasi</h1>
	<div>
		<h2>Devices</h2>
		<div id='devices'>
		</div>
	</div>
</body>
</html>